---
import { type CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';

interface Props {
	post: CollectionEntry<'blog'> | CollectionEntry<'projects'>;
}

const { post } = Astro.props;

// Function to generate a deterministic gradient based on the title length/char code
const getGradient = (str: string) => {
    const gradients = [
        'bg-gradient-to-br from-pink-500 to-rose-500',
        'bg-gradient-to-br from-purple-500 to-indigo-500',
        'bg-gradient-to-br from-cyan-500 to-blue-500',
        'bg-gradient-to-br from-emerald-500 to-teal-500',
        'bg-gradient-to-br from-orange-400 to-red-500',
        'bg-gradient-to-br from-fuchsia-500 to-purple-600',
    ];
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        hash = str.charCodeAt(i) + ((hash << 5) - hash);
    }
    const index = Math.abs(hash) % gradients.length;
    return gradients[index];
};

const gradientClass = getGradient(post.data.title);
---

<a
	href={`/${post.collection}/${post.slug}/`}
	class="group relative block overflow-hidden rounded-2xl bg-white/70 dark:bg-slate-950/40 border border-slate-200/70 dark:border-slate-800/70 shadow-sm hover:shadow-lg transition-all duration-300 hover:-translate-y-0.5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500/60"
>
	<div class={`aspect-video w-full overflow-hidden ${post.data.heroImage || post.data.image ? '' : gradientClass} relative`}>
        {post.data.heroImage || post.data.image ? (
            <img 
                src={post.data.heroImage || post.data.image} 
                alt="" 
                class="h-full w-full object-cover object-center group-hover:scale-[1.03] transition-transform duration-500"
            />
        ) : (
            <div class="flex h-full items-center justify-center p-6">
                 <h3 class="text-2xl font-bold text-white text-center drop-shadow-md opacity-90 group-hover:scale-105 transition-transform duration-300">
                    {post.data.title}
                 </h3>
            </div>
        )}
		<div class="absolute inset-0 bg-gradient-to-t from-slate-950/40 via-slate-950/0 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
	</div>
	<div class="p-6">
		<div class="flex items-center gap-3 text-sm text-slate-500 dark:text-slate-400 mb-3">
            {post.data.pubDate && <FormattedDate date={post.data.pubDate} />}
            {post.data.tags && (
				<div class="flex flex-wrap gap-2 mt-auto">
					{post.data.tags.slice(0, 4).map((tag: string) => (
						<span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300 border border-slate-200 dark:border-slate-700">
							{tag}
						</span>
					))}
					{post.data.tags.length > 4 && (
						<span class="inline-flex items-center px-2 py-0.5 text-xs text-slate-500 dark:text-slate-400">
							+{post.data.tags.length - 4}
						</span>
					)}
				</div>
			)}
		</div>
		<div class="flex items-start justify-between gap-4">
			<div>
				<h3 class="text-lg font-bold tracking-tight text-slate-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors mb-2">
					{post.data.title}
				</h3>
				<p class="text-slate-600 dark:text-slate-400 line-clamp-2 text-sm leading-relaxed mb-4">
					{post.data.description}
				</p>
			</div>
		</div>
		
		{post.collection === 'projects' && (post.data.repoUrl || post.data.demoUrl) && (
			<div class="flex items-center gap-3 pt-4 mt-auto border-t border-slate-100 dark:border-slate-800/50">
				{post.data.repoUrl && (
					<span class="flex items-center gap-1.5 text-xs font-medium text-slate-600 dark:text-slate-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">
						<svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405 1.02 0 2.04.135 3 .405 2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.92 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.285 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
						Source
					</span>
				)}
				{post.data.demoUrl && (
					<span class="flex items-center gap-1.5 text-xs font-medium text-slate-600 dark:text-slate-400 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
						<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
						Demo
					</span>
				)}
			</div>
		)}
	</div>
</a>
