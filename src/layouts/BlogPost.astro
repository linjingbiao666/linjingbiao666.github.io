---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Giscus from "../components/Giscus.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage, tags } =
	Astro.props;
---

<BaseLayout title={title} description={description} image={heroImage}>
	<article class="mx-auto max-w-4xl">
		<div
			class="not-prose mb-10 rounded-3xl border border-slate-200/70 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/40 p-6 sm:p-8 shadow-sm"
		>
			<div class="flex flex-col gap-5">
				<div
					class="flex items-center justify-between gap-4 text-sm text-slate-500 dark:text-slate-400"
				>
					<a
						href="/blog"
						class="inline-flex items-center gap-2 hover:text-slate-900 dark:hover:text-white transition-colors"
					>
						<span aria-hidden="true">←</span>
						<span>返回文章列表</span>
					</a>
					<div class="flex items-center gap-4">
						<div class="inline-flex items-center gap-2">
							<span class="text-slate-500 dark:text-slate-500"
								>发布</span
							>
							<FormattedDate date={pubDate} />
						</div>
						{
							updatedDate && (
								<div class="hidden sm:inline-flex items-center gap-2 italic">
									<span class="text-slate-500 dark:text-slate-500">
										更新
									</span>
									<FormattedDate date={updatedDate} />
								</div>
							)
						}
					</div>
				</div>

				<h1
					class="text-3xl sm:text-5xl font-extrabold tracking-tight text-slate-900 dark:text-white"
				>
					{title}
				</h1>

				{
					tags && (
						<div class="flex flex-wrap gap-2">
							{tags.map((tag: string) => (
								<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-slate-100/80 text-slate-700 dark:bg-slate-800/70 dark:text-slate-200 border border-slate-200/60 dark:border-slate-700/60">
									#{tag}
								</span>
							))}
						</div>
					)
				}

				{
					heroImage && (
						<div class="rounded-2xl overflow-hidden border border-slate-200/60 dark:border-slate-800/60 shadow-sm aspect-video">
							<img
								width={1020}
								height={510}
								src={heroImage}
								alt=""
								class="w-full h-full object-cover"
							/>
						</div>
					)
				}
			</div>
		</div>

		<div
			class="prose prose-slate dark:prose-invert sm:prose-lg max-w-none prose-headings:scroll-mt-24 prose-img:rounded-2xl"
		>
			<slot />
		</div>

		<div
			class="mt-16 pt-8 border-t border-slate-200/70 dark:border-slate-800/70"
		>
			<Giscus />
		</div>
	</article>
</BaseLayout>
